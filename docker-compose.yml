version: "3.9"

services:
  ollama-admin:
    build: .
    ports:
      - "3000:3000"
    environment:
      DATABASE_URL: ${DATABASE_URL:-file:/data/ollama-admin.db}
      DEFAULT_OLLAMA_URL: ${DEFAULT_OLLAMA_URL:-http://host.docker.internal:11434}
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET:-changeme}
      NEXTAUTH_URL: ${NEXTAUTH_URL:-http://localhost:3000}
      AUTH_ENABLED: ${AUTH_ENABLED:-false}
      LOG_RETENTION_DAYS: ${LOG_RETENTION_DAYS:-90}
      LOG_STORE_PROMPTS: ${LOG_STORE_PROMPTS:-true}
      CATALOG_REFRESH_ENABLED: ${CATALOG_REFRESH_ENABLED:-true}
      CATALOG_RATE_LIMIT_MS: ${CATALOG_RATE_LIMIT_MS:-2000}
      GPU_AGENT_ENABLED: ${GPU_AGENT_ENABLED:-false}
    volumes:
      - ollama-admin-data:/data
    restart: unless-stopped

  # Optional: GPU monitoring agent
  # gpu-agent:
  #   image: registry.harbor.io/ollama-admin/gpu-agent:latest
  #   runtime: nvidia
  #   environment:
  #     NVIDIA_VISIBLE_DEVICES: all
  #   ports:
  #     - "9999:9999"
  #   restart: unless-stopped

volumes:
  ollama-admin-data:
